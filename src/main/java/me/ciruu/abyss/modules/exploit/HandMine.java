package me.ciruu.abyss.modules.exploit;

import java.util.function.Predicate;
import me.ciruu.abyss.Class155;
import me.ciruu.abyss.Globals;
import me.ciruu.abyss.enums.Class11;
import me.ciruu.abyss.enums.Class53;
import me.ciruu.abyss.events.player.EventPlayerDamageBlock;
import me.ciruu.abyss.events.player.EventPlayerUpdateWalking;
import me.ciruu.abyss.modules.Module;
import me.ciruu.abyss.settings.Setting;
import me.zero.alpine.listener.EventHandler;
import me.zero.alpine.listener.Listener;
import net.minecraft.block.Block;
import net.minecraft.init.Blocks;
import net.minecraft.init.Items;
import net.minecraft.item.Item;
import net.minecraft.item.ItemAxe;
import net.minecraft.item.ItemSword;
import net.minecraft.util.EnumHand;
import net.minecraft.util.math.BlockPos;
import net.minecraft.world.World;

public class HandMine
extends Module {
    private static boolean Field3263;
    public Setting ignoreSword = new Setting("IgnoreSword", "", this, false);
    @EventHandler
    private Listener Field3265 = new Listener<EventPlayerUpdateWalking>(this::Method3934, new Predicate[0]);
    @EventHandler
    private Listener Field3266 = new Listener<EventPlayerDamageBlock>(this::Method3935, new Predicate[0]);

    public HandMine() {
        super("HandMine", "Allows you to pick blocks with your hand if you have a pickaxe in your hotbar.", Class11.EXPLOIT);
        this.Method3936(this.ignoreSword);
    }

    public void Method3937() {
        super.Method15();
        Field3263 = false;
    }

    private boolean Method3938() {
        Block[] blockArray;
        Item item = Globals.mc.player.getHeldItemMainhand().getItem();
        if (((Boolean)this.ignoreSword.getValue()).booleanValue() && item instanceof ItemAxe || ((Boolean)this.ignoreSword.getValue()).booleanValue() && item instanceof ItemSword) {
            return false;
        }
        for (Block block : blockArray = new Block[]{Blocks.WEB}) {
            if (this.Method3939(Globals.mc.objectMouseOver.getBlockPos()) != block) continue;
            return false;
        }
        return true;
    }

    public static int Method3940() {
        Item[] itemArray;
        for (Item item : itemArray = new Item[]{Items.DIAMOND_PICKAXE, Items.GOLDEN_PICKAXE, Items.IRON_PICKAXE, Items.STONE_PICKAXE, Items.WOODEN_PICKAXE}) {
            int n = Class155.Method745(item);
            if (n == -1) continue;
            return n;
        }
        return -1;
    }

    private Block Method3939(BlockPos blockPos) {
        try {
            return Globals.mc.world.getBlockState(blockPos).getBlock();
        }
        catch (NullPointerException nullPointerException) {
            return null;
        }
    }

    private void Method3935(EventPlayerDamageBlock eventPlayerDamageBlock) {
        if (Globals.mc.player.inventory.currentItem != HandMine.Method3940() && !Field3263 && this.Method3938()) {
            eventPlayerDamageBlock.cancel();
        }
    }

    private void Method3934(EventPlayerUpdateWalking eventPlayerUpdateWalking) {
        if (Globals.mc.player == null || !Globals.mc.gameSettings.keyBindAttack.isKeyDown() || Globals.mc.objectMouseOver.getBlockPos() == null || eventPlayerUpdateWalking.Method100() != Class53.PRE) {
            return;
        }
        if (Globals.mc.world.getBlockState(Globals.mc.objectMouseOver.getBlockPos()).getBlockHardness((World)Globals.mc.world, Globals.mc.objectMouseOver.getBlockPos()) <= 0.0f) {
            Field3263 = true;
            return;
        }
        if (!this.Method3938()) {
            return;
        }
        int n = HandMine.Method3940();
        if (n == -1) {
            Field3263 = true;
            return;
        }
        if (n == Globals.mc.player.inventory.currentItem) {
            return;
        }
        Field3263 = false;
        int n2 = Globals.mc.player.inventory.currentItem;
        Globals.mc.player.inventory.currentItem = n;
        Globals.mc.playerController.updateController();
        Globals.mc.player.swingArm(EnumHand.MAIN_HAND);
        Globals.mc.playerController.onPlayerDamageBlock(Globals.mc.objectMouseOver.getBlockPos(), Globals.mc.objectMouseOver.sideHit);
        Globals.mc.player.inventory.currentItem = n2;
        Globals.mc.playerController.updateController();
    }
}

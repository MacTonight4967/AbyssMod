package me.ciruu.abyss.modules.exploit;

import io.netty.buffer.Unpooled;
import java.util.function.Predicate;
import me.ciruu.abyss.Globals;
import me.ciruu.abyss.enums.Class11;
import me.ciruu.abyss.events.network.EventNetworkPostPacketEvent;
import me.ciruu.abyss.modules.Module;
import me.zero.alpine.listener.EventHandler;
import me.zero.alpine.listener.Listener;
import net.minecraft.network.PacketBuffer;
import net.minecraft.network.play.client.CPacketCustomPayload;
import net.minecraftforge.fml.common.network.internal.FMLProxyPacket;

public class NoHandShake
extends Module {
    @EventHandler
    private Listener Field1352 = new Listener<EventNetworkPostPacketEvent>(NoHandShake::Method1766, new Predicate[0]);

    public NoHandShake() {
        super("NoHandShake", "Prevents you send your modlist to the server.", Class11.EXPLOIT);
    }

    private static void Method1766(EventNetworkPostPacketEvent eventNetworkPostPacketEvent) {
        CPacketCustomPayload cPacketCustomPayload;
        if (eventNetworkPostPacketEvent.Method16() instanceof FMLProxyPacket && !Globals.mc.isSingleplayer()) {
            eventNetworkPostPacketEvent.cancel();
        }
        if (eventNetworkPostPacketEvent.Method16() instanceof CPacketCustomPayload && (cPacketCustomPayload = (CPacketCustomPayload)eventNetworkPostPacketEvent.Method16()).getChannelName().equals("MC|Brand")) {
            cPacketCustomPayload.data = new PacketBuffer(Unpooled.buffer()).writeString("vanilla");
        }
    }
}

package me.ciruu.abyss.modules.exploit;

import java.util.function.Predicate;
import me.ciruu.abyss.Class25;
import me.ciruu.abyss.Globals;
import me.ciruu.abyss.enums.Class11;
import me.ciruu.abyss.enums.Class413;
import me.ciruu.abyss.events.player.EventPlayerUpdate;
import me.ciruu.abyss.modules.Module;
import me.ciruu.abyss.settings.Setting;
import me.zero.alpine.listener.EventHandler;
import me.zero.alpine.listener.Listener;
import net.minecraft.entity.Entity;
import net.minecraft.entity.item.EntityItemFrame;
import net.minecraft.init.Items;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.CPacketAnimation;
import net.minecraft.network.play.client.CPacketUseEntity;
import net.minecraft.util.EnumHand;

public class FrameDupe
extends Module {
    private final Setting main = new Setting("Main", "", this, new Class25("Main Settings"));
    private final Setting range = new Setting("Range", "", (Module)this, (Object)Float.valueOf(6.0f), Float.valueOf(0.0f), Float.valueOf(6.0f));
    private final Setting safe = new Setting("Safe", "", this, false);
    private final Setting placeDelay = new Setting("PlaceDelay", "", (Module)this, (Object)0, 0, 10);
    private final Setting breakDelay = new Setting("BreakDelay", "", (Module)this, (Object)0, 0, 10);
    private final Setting limit = new Setting("Limit", "", this, true);
    private final Setting count = new Setting("Count", "", this, 1, 1, 50, this.main, this.limit::getValue);
    private final Setting swing = new Setting("Swing", "", this, (Object)Class413.Break);
    private int Field2816 = 0;
    private int Field2817 = 0;
    @EventHandler
    private Listener Field2818 = new Listener<EventPlayerUpdate>(this::Method3415, new Predicate[0]);

    public FrameDupe() {
        super("FrameDupe", "", Class11.EXPLOIT);
        this.Method3416(this.range);
        this.Method3416(this.safe);
        this.Method3416(this.placeDelay);
        this.Method3416(this.breakDelay);
        this.Method3416(this.limit);
        this.Method3416(this.count);
        this.Method3416(this.swing);
    }

    public void Method3417(boolean bl) {
        if (this.Method3418()) {
            this.Method3419(false);
            this.Method3420();
        }
    }

    private void Method3415(EventPlayerUpdate eventPlayerUpdate) {
        if (Globals.mc.player == null || Globals.mc.world == null) {
            return;
        }
        if (Globals.mc.player.getHeldItemMainhand().isEmpty()) {
            return;
        }
        if (((Boolean)this.safe.getValue()).booleanValue() && Globals.mc.player.getHeldItemMainhand().getCount() < 2) {
            return;
        }
        int n = 0;
        for (Entity entity : Globals.mc.world.loadedEntityList) {
            EntityItemFrame entityItemFrame;
            if (!(entity instanceof EntityItemFrame) || Globals.mc.player.getDistance((Entity)(entityItemFrame = (EntityItemFrame)entity)) > ((Float)this.range.getValue()).floatValue()) continue;
            if (((Boolean)this.limit.getValue()).booleanValue() && n >= (Integer)this.count.getValue()) break;
            if (this.Field2816 >= (Integer)this.placeDelay.getValue()) {
                ++n;
                this.Field2816 = 0;
                Globals.mc.player.connection.sendPacket((Packet)new CPacketUseEntity((Entity)entityItemFrame, EnumHand.MAIN_HAND));
                if (this.swing.getValue() == Class413.Both || this.swing.getValue() == Class413.Place) {
                    Globals.mc.player.connection.sendPacket((Packet)new CPacketAnimation(EnumHand.MAIN_HAND));
                }
            }
            if (entityItemFrame.getDisplayedItem().getItem() == Items.AIR || entityItemFrame.getDisplayedItem().isEmpty() || this.Field2817 < (Integer)this.breakDelay.getValue()) continue;
            this.Field2817 = 0;
            ++n;
            Globals.mc.player.connection.sendPacket((Packet)new CPacketUseEntity((Entity)entityItemFrame));
            if (this.swing.getValue() != Class413.Both && this.swing.getValue() != Class413.Break) continue;
            Globals.mc.player.connection.sendPacket((Packet)new CPacketAnimation(EnumHand.MAIN_HAND));
        }
        ++this.Field2816;
        ++this.Field2817;
    }
}
